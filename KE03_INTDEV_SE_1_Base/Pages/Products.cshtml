@page
@model KE03_INTDEV_SE_1_Base.Pages.ProductsModel

@{
    ViewData["Title"] = "Alle Producten";
}

<h1>Alle Producten</h1>

<!-- Toast notificatie met afbeelding -->
<div aria-live="polite" aria-atomic="true" class="position-fixed bottom-0 end-0 p-3" style="z-index: 9999">
    <div id="productToast" class="toast align-items-center text-white bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <img id="toastImage" src="" alt="Product afbeelding" style="height: 64px; width: 64px; object-fit: cover; margin-right: 10px; border-radius: 5px;">
            <div class="toast-body" id="toastText">
                Product is toegevoegd aan je winkelmand!
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Sluiten"></button>
        </div>
    </div>
</div>

<div class="product-grid">
    @foreach (var product in Model.Products)
    {
        <div class="product-card">
            @if (product.DiscountPercentage > 0)
            {
                <div class="discount-badge">-@product.DiscountPercentage% SALE</div>
            }
            <img src="@product.ImageUrl" alt="@product.Name" class="product-image" />
            <div class="product-title">@product.Name</div>
            <div class="product-description">@product.Description</div>
            <div class="product-price">
    @if (product.DiscountPercentage > 0)
    {
        <span style="text-decoration: line-through; color: #999;">
            € @product.Price.ToString("0.00")
        </span>
        <span style="color: #e63946; font-weight: 700; margin-left: 8px;">
            € @( (product.Price * (1 - product.DiscountPercentage / 100m)).ToString("0.00") )
        </span>
    }
    else
    {
        <text>€ @product.Price.ToString("0.00")</text>
    }
</div>


            <form method="post" asp-page-handler="AddToCart" class="mb-2">
                <input type="hidden" name="productId" value="@product.Id" />
                <button type="submit" class="btn btn-success btn-sm">Toevoegen aan winkelwagen</button>
            </form>

            <a asp-page="/ProductDetails" asp-route-id="@product.Id" class="btn btn-outline-primary btn-sm">Bekijk product</a>
        </div>
    }
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            @if (TempData["ProductName"] != null && TempData["ProductImage"] != null)
            {
                    <text>
                        var toastEl = document.getElementById('productToast');
                        var toastText = document.getElementById('toastText');
                        var toastImage = document.getElementById('toastImage');

                        toastText.textContent = "@TempData["ProductName"] is toegevoegd aan je winkelmand!";
                        toastImage.src = "@TempData["ProductImage"]";

                        var toast = new bootstrap.Toast(toastEl, { delay: 3000 });
                        toast.show();
                    </text>
            }
        });
    </script>
}
